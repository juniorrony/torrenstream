<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåê Multi-Source Torrent Discovery</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .hero {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24, #feca57, #48dbfb);
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
            background-size: 400% 400%;
            animation: gradientShift 8s ease infinite;
        }
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .container {
            background: rgba(20, 20, 20, 0.9);
            backdrop-filter: blur(15px);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .sources-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        .source-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.2);
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .source-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }
        .source-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        .source-card:hover::before {
            left: 100%;
        }
        .source-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #fff;
        }
        .reliability-bar {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        .reliability-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #feca57, #48dbfb);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        .search-section {
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 15px;
            align-items: end;
            margin-bottom: 30px;
        }
        .advanced-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
            padding: 20px;
            background: rgba(30, 30, 30, 0.7);
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        input, select, button {
            padding: 12px 16px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        input::placeholder {
            color: rgba(255,255,255,0.6);
        }
        input:focus, select:focus {
            outline: none;
            border-color: #48dbfb;
            box-shadow: 0 0 10px rgba(72, 219, 251, 0.3);
        }
        button {
            background: linear-gradient(45deg, #48dbfb, #0abde3);
            border: none;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(72, 219, 251, 0.3);
        }
        .search-btn {
            background: linear-gradient(45deg, #10ac84, #00d2d3);
            grid-column: span 2;
        }
        .results-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(450px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }
        .torrent-result {
            background: linear-gradient(135deg, rgba(50, 50, 50, 0.9), rgba(30, 30, 30, 0.9));
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            position: relative;
        }
        .torrent-result:hover {
            transform: scale(1.02);
            border-color: #48dbfb;
            box-shadow: 0 10px 30px rgba(72, 219, 251, 0.2);
        }
        .torrent-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 12px;
            color: #fff;
            line-height: 1.4;
        }
        .source-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 4px 10px;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        .stat {
            background: rgba(60, 60, 60, 0.7);
            padding: 8px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .stat-value {
            font-size: 16px;
            font-weight: bold;
            color: #48dbfb;
        }
        .stat-label {
            font-size: 10px;
            color: #ccc;
            text-transform: uppercase;
        }
        .health-indicator {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
            overflow: hidden;
            margin: 10px 0;
        }
        .health-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        .actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .btn-small {
            flex: 1;
            padding: 8px 12px;
            font-size: 12px;
        }
        .btn-preview { background: linear-gradient(45deg, #9c27b0, #7b1fa2); }
        .btn-add { background: linear-gradient(45deg, #4caf50, #388e3c); }
        .btn-health { background: linear-gradient(45deg, #ff9800, #f57c00); }
        #log {
            background: rgba(10, 10, 10, 0.9);
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
            border: 1px solid rgba(255,255,255,0.1);
            color: #00ff00;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #48dbfb;
        }
        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(72, 219, 251, 0.3);
            border-radius: 50%;
            border-top-color: #48dbfb;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 10px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .feature-highlight {
            background: linear-gradient(45deg, rgba(255, 107, 107, 0.2), rgba(72, 219, 251, 0.2));
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border: 1px solid rgba(255, 107, 107, 0.3);
        }
    </style>
</head>
<body>
    <div class="hero">
        <h1>üåê Multi-Source Torrent Discovery Platform</h1>
        <p>Search across 6 major torrent sources with advanced filtering and health scoring</p>
        <p><strong>PirateBay ‚Ä¢ YTS ‚Ä¢ 1337x ‚Ä¢ RARBG ‚Ä¢ Nyaa ‚Ä¢ TorrentGalaxy</strong></p>
    </div>

    <div class="container">
        <h2>üìä Source Network Status</h2>
        <div id="sourcesGrid" class="sources-grid">
            <div class="loading">
                <div class="spinner"></div>
                <p>Loading source network...</p>
            </div>
        </div>
    </div>

    <div class="container">
        <h2>üîç Advanced Multi-Source Search</h2>
        
        <div class="search-section">
            <input type="text" id="searchQuery" placeholder="Search across all sources..." value="movie">
            <button onclick="loadSourceStats()">üîÑ Refresh Sources</button>
            <button class="search-btn" onclick="performAdvancedSearch()">üöÄ Search All Sources</button>
        </div>

        <div class="advanced-filters" id="advancedFilters" style="display: none;">
            <div>
                <label>Category</label>
                <select id="category">
                    <option value="all">All Categories</option>
                    <option value="201">Movies</option>
                    <option value="202">TV Shows</option>
                    <option value="100">Music</option>
                    <option value="300">Software</option>
                </select>
            </div>
            <div>
                <label>Sort By</label>
                <select id="sortBy">
                    <option value="seeders">Most Seeders</option>
                    <option value="health">Best Health</option>
                    <option value="size">Largest Size</option>
                    <option value="date">Most Recent</option>
                </select>
            </div>
            <div>
                <label>Min Health Score</label>
                <input type="range" id="minHealth" min="0" max="100" value="50">
                <span id="healthValue">50</span>%
            </div>
            <div>
                <label>Min Seeders</label>
                <input type="number" id="minSeeders" min="1" max="1000" value="5">
            </div>
            <div>
                <label>Max Size (GB)</label>
                <input type="number" id="maxSize" min="0.1" max="100" step="0.1" placeholder="No limit">
            </div>
            <div>
                <label>Preferred Sources</label>
                <select id="preferredSources" multiple>
                    <option value="piratebay">PirateBay</option>
                    <option value="yts">YTS</option>
                    <option value="1337x">1337x</option>
                    <option value="rarbg">RARBG</option>
                    <option value="nyaa">Nyaa</option>
                    <option value="torrentgalaxy">TorrentGalaxy</option>
                </select>
            </div>
        </div>

        <button onclick="toggleAdvancedFilters()">‚öôÔ∏è Toggle Advanced Filters</button>
    </div>

    <div class="container">
        <div class="feature-highlight">
            <h3>üåü What Makes This Special</h3>
            <p><strong>6 Source Aggregation:</strong> Searches PirateBay, YTS, 1337x, RARBG, Nyaa, and TorrentGalaxy simultaneously</p>
            <p><strong>Health Scoring:</strong> Intelligent algorithm considers seeders, source reliability, and popularity</p>
            <p><strong>Smart Filtering:</strong> Advanced filters by size, health, year, quality, and source preference</p>
            <p><strong>Real-time Data:</strong> Live peer counts and torrent health indicators</p>
        </div>
    </div>

    <div class="container">
        <h2>üéØ Search Results</h2>
        <div id="searchResults">
            <div style="text-align: center; padding: 40px; color: #ccc;">
                Enter a search term and click "Search All Sources" to discover torrents across multiple networks!
            </div>
        </div>
    </div>

    <div class="container">
        <h2>üì° API Activity Log</h2>
        <button onclick="clearLog()">üóëÔ∏è Clear Log</button>
        <button onclick="testAllAPIs()">üß™ Test All APIs</button>
        <div id="log">Multi-source discovery platform initialized...\n</div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api';
        let sourceStats = null;
        
        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.textContent += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').textContent = 'Log cleared...\n';
        }

        async function loadSourceStats() {
            try {
                log('üîÑ Loading source network status...');
                
                const response = await fetch(`${API_BASE}/sources/stats`);
                sourceStats = await response.json();
                
                log(`‚úÖ Loaded ${sourceStats.totalSources} sources (${sourceStats.activeSources} active)`);
                displaySourceStats(sourceStats.sources);
                
            } catch (error) {
                log(`‚ùå Source stats failed: ${error.message}`);
                displaySourceStats([]);
            }
        }

        function displaySourceStats(sources) {
            const grid = document.getElementById('sourcesGrid');
            
            if (sources.length === 0) {
                grid.innerHTML = '<div style="text-align: center; color: #999;">Failed to load source statistics</div>';
                return;
            }

            grid.innerHTML = sources.map(source => `
                <div class="source-card">
                    <div class="source-name">${source.name.toUpperCase()}</div>
                    <div class="reliability-bar">
                        <div class="reliability-fill" style="width: ${source.reliability * 100}%"></div>
                    </div>
                    <div style="font-size: 12px; margin: 8px 0;">
                        Reliability: ${Math.round(source.reliability * 100)}%
                    </div>
                    <div style="font-size: 11px; color: #ccc;">
                        ${source.categories.join(', ')}
                    </div>
                    <div style="margin-top: 10px;">
                        <span style="padding: 3px 8px; background: ${source.status === 'active' ? '#4caf50' : '#f44336'}; border-radius: 10px; font-size: 10px;">
                            ${source.status.toUpperCase()}
                        </span>
                    </div>
                </div>
            `).join('');
        }

        async function performAdvancedSearch() {
            const query = document.getElementById('searchQuery').value.trim();
            if (!query) {
                log('‚ùå Please enter a search query');
                return;
            }

            const resultsDiv = document.getElementById('searchResults');
            resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div><p>Searching across all sources...</p></div>';

            try {
                log(`üîç Multi-source search: "${query}"`);
                
                const params = new URLSearchParams({
                    q: query,
                    category: document.getElementById('category').value,
                    sortBy: document.getElementById('sortBy').value,
                    minHealth: document.getElementById('minHealth').value,
                    minSeeders: document.getElementById('minSeeders').value,
                    limit: 30
                });

                const maxSize = document.getElementById('maxSize').value;
                if (maxSize) {
                    params.append('maxSize', maxSize * 1024 * 1024 * 1024); // Convert GB to bytes
                }

                const response = await fetch(`${API_BASE}/search/advanced?${params}`);
                const data = await response.json();

                log(`‚úÖ Found ${data.results} torrents from multiple sources`);
                
                if (data.torrents && data.torrents.length > 0) {
                    const sourceCount = new Set(data.torrents.map(t => t.source)).size;
                    log(`üìä Results from ${sourceCount} different sources`);
                }
                
                displaySearchResults(data.torrents || []);

            } catch (error) {
                log(`‚ùå Multi-source search failed: ${error.message}`);
                resultsDiv.innerHTML = '<div style="text-align: center; color: #f44336;">Search failed. Please try again.</div>';
            }
        }

        function displaySearchResults(torrents) {
            const resultsDiv = document.getElementById('searchResults');

            if (torrents.length === 0) {
                resultsDiv.innerHTML = '<div style="text-align: center; color: #999;">No torrents found. Try different keywords or adjust filters.</div>';
                return;
            }

            resultsDiv.innerHTML = `
                <div style="margin-bottom: 20px; text-align: center;">
                    <strong>${torrents.length} torrents found from ${new Set(torrents.map(t => t.source)).size} sources</strong>
                </div>
                <div class="results-container">
                    ${torrents.map(torrent => createTorrentCard(torrent)).join('')}
                </div>
            `;
        }

        function createTorrentCard(torrent) {
            const health = torrent.health || 50;
            const healthColor = health > 70 ? '#4caf50' : health > 40 ? '#ff9800' : '#f44336';
            const seedColor = torrent.seeders > 100 ? '#4caf50' : torrent.seeders > 20 ? '#ff9800' : '#f44336';
            
            return `
                <div class="torrent-result">
                    <div class="source-badge">${torrent.source}</div>
                    <div class="torrent-title">${torrent.name}</div>
                    
                    <div class="health-indicator">
                        <div class="health-fill" style="width: ${health}%; background: ${healthColor};"></div>
                    </div>
                    <div style="font-size: 11px; color: #ccc; margin-bottom: 10px;">
                        Health Score: ${health}% ‚Ä¢ Reliability: ${Math.round((torrent.sourceReliability || 0.5) * 100)}%
                    </div>

                    <div class="stats-grid">
                        <div class="stat">
                            <div class="stat-value" style="color: ${seedColor}">${torrent.seeders}‚Üë</div>
                            <div class="stat-label">Seeds</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" style="color: #ff5722">${torrent.leechers}‚Üì</div>
                            <div class="stat-label">Leech</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${formatBytes(torrent.size)}</div>
                            <div class="stat-label">Size</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${torrent.files}</div>
                            <div class="stat-label">Files</div>
                        </div>
                    </div>

                    <div style="font-size: 11px; color: #999; margin: 10px 0;">
                        ${torrent.category} ‚Ä¢ ${torrent.uploader} ‚Ä¢ ${new Date(torrent.date).toLocaleDateString()}
                    </div>

                    <div class="actions">
                        <button class="btn-small btn-preview" onclick="testTorrent('${torrent.infoHash}', 'preview')">
                            üëÅÔ∏è Preview
                        </button>
                        <button class="btn-small btn-add" onclick="testTorrent('${torrent.infoHash}', 'add')">
                            ‚ûï Add
                        </button>
                        <button class="btn-small btn-health" onclick="testTorrent('${torrent.infoHash}', 'health')">
                            üìä Health
                        </button>
                    </div>
                </div>
            `;
        }

        async function testTorrent(infoHash, action) {
            switch (action) {
                case 'preview':
                    log(`üëÅÔ∏è Testing preview for torrent: ${infoHash.substr(0, 8)}...`);
                    break;
                case 'add':
                    log(`‚ûï Testing add for torrent: ${infoHash.substr(0, 8)}...`);
                    break;
                case 'health':
                    log(`üìä Getting health data for: ${infoHash.substr(0, 8)}...`);
                    try {
                        const response = await fetch(`${API_BASE}/peers/${infoHash}`);
                        const data = await response.json();
                        log(`üìà Live: ${data.seeders} seeds, ${data.leechers} leech, ${data.completed} completed`);
                    } catch (error) {
                        log(`‚ùå Health check failed: ${error.message}`);
                    }
                    break;
            }
        }

        function toggleAdvancedFilters() {
            const filters = document.getElementById('advancedFilters');
            filters.style.display = filters.style.display === 'none' ? 'grid' : 'none';
        }

        async function testAllAPIs() {
            log('üß™ Testing all multi-source APIs...');
            
            await loadSourceStats();
            await performAdvancedSearch();
            
            log('‚úÖ All multi-source API tests completed!');
        }

        function formatBytes(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        // Update health slider value display
        document.getElementById('minHealth').addEventListener('input', function() {
            document.getElementById('healthValue').textContent = this.value;
        });

        // Auto-load on page ready
        window.addEventListener('load', () => {
            log('üåü Multi-source discovery platform loaded');
            log('üí° Testing search across 6 torrent sources...');
            
            loadSourceStats();
            
            // Auto-search after a delay
            setTimeout(() => {
                performAdvancedSearch();
            }, 2000);
        });
    </script>
</body>
</html>